unit ProductCUForm;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, DateUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.ExtCtrls, Vcl.StdCtrls, DataModule;

type
  TfrmProductCU = class(TForm)
    Panel1: TPanel;
    Label1: TLabel;
    Label2: TLabel;
    Label3: TLabel;
    Label4: TLabel;
    Label5: TLabel;
    edtOrderDetailUID: TEdit;
    edtLineNumber: TEdit;
    edtProductNumber: TEdit;
    edtQuantity: TEdit;
    edtPriceAmnt: TEdit;
    btnCreate: TButton;
    Button2: TButton;
    procedure FormShow(Sender: TObject);
  private
    { Private declarations }
    procedure LoadOrderDetailData;
  public
    { Public declarations }
  end;

var
  frmProductCU: TfrmProductCU;

implementation

{$R *.dfm}

function GetTimeBasedID: Int64;
begin
  Result := DateTimeToUnix(Now, False) * 1000 + MilliSecondOf(Now);
end;

procedure TfrmProductCU.FormShow(Sender: TObject);
begin
  if (self.Caption = 'Add Product') then
  begin
    // Clear the fields for creating a new customer
    edtOrderDetailUID.Clear;
    edtLineNumber.Clear;
    edtProductNumber.Clear;
    edtQuantity.Clear;
    edtPriceAmnt.Clear;
    // Disable the customer UID field so users can't modify it
    edtOrderDetailUID.Enabled := False;
  end
  else if (self.Caption = 'Update Product') then
  begin
    // Load the customer data for updating
    edtOrderDetailUID.Enabled := False; // Disable it for updates as well
    LoadOrderDetailData;
  end;
end;

// Procedure to load selected product data for update
procedure TfrmProductCU.LoadOrderDetailData;
begin
  with DM.OrdrDtlQrySELECT do
  begin
    SQL.Clear;
    SQL.Text := 'SELECT * FROM order_details WHERE order_detail_uid = :order_detail_uid';
    Params.ParamByName('order_detail_uid').AsString := frmProductCU.Hint;
    Open;

    // Populate the fields with the selected customer data
    if not IsEmpty then
    begin
      edtOrderDetailUID.Text := FieldByName('order_detail_uid').AsString;
      edtLineNumber.Text := FieldByName('line_no').AsString;
      edtProductNumber.Text := FieldByName('product_no').AsString;
      edtQuantity.Text := FieldByName('quantity').AsString;
      edtPriceAmnt.Text := FieldByName('price_amt').AsString;
    end;

    Close;
  end;
end;

end.
